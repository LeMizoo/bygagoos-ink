# docker-compose.yml - VERSION SQLITE
services:
  # SUPPRIMEZ le service postgres - on utilise SQLite
  
  backend:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: bygagoos-backend
    ports:
      - "3001:3001"
    environment:
      DATABASE_URL: "file:/app/data/dev.db"
      JWT_SECRET: "bygagoos-super-secret-key-2025-change-in-production"
      PORT: "3001"
      NODE_ENV: "development"
      CORS_ORIGIN: "http://localhost:5173"
    volumes:
      - ./public:/app/public
      - ./uploads:/app/uploads
      - ./data:/app/data  # Pour persister la base SQLite
    command: >
      sh -c "
        echo 'ğŸ”§ Installation des dÃ©pendances...' &&
        npm install &&
        echo 'ğŸ“Š PrÃ©paration Prisma...' &&
        npx prisma generate &&
        echo 'ğŸ—„ï¸  Initialisation base SQLite...' &&
        npx prisma db push --accept-data-loss &&
        echo 'ğŸŒ± Insertion donnÃ©es...' &&
        node scripts/seed-sqlite.js &&
        echo 'ğŸš€ DÃ©marrage du serveur...' &&
        node app.js
      "